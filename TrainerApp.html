<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>CRM Trainer.Ai — Тренер</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    
    /* Модальное окно AI */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 50;
      display: none;
    }
    .modal-overlay.active { display: block; }
    
    .modal-content {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 85vh;
      background: white;
      border-radius: 16px 16px 0 0;
      overflow: hidden;
      z-index: 51;
      transform: translateY(100%);
      transition: transform 0.3s ease-out;
    }
    
    .modal-overlay.active .modal-content {
      transform: translateY(0);
    }
    
    /* Табы в Client Detail */
    .tab-indicator {
      position: absolute;
      bottom: 0;
      height: 2px;
      background: #2563eb;
      transition: all 0.3s ease;
    }
  </style>
</head>
<body class="bg-gray-50">
  
  <!-- Main Container -->
  <div id="app" class="w-full h-screen max-w-sm mx-auto bg-white flex flex-col relative">
    
    <!-- Header -->
    <div id="app-header" class="bg-white p-4 border-b border-gray-200">
      <div class="flex justify-between items-center">
        <h1 id="header-title" class="text-lg font-semibold text-gray-900">Сводка</h1>
        <button id="ai-chat-btn" class="text-white text-sm font-medium py-2 px-4 rounded-lg" style="background: linear-gradient(90deg, #4A90E2 0%, #7C3AED 100%);">
          Ai-чат
        </button>
      </div>
    </div>
    
    <!-- Screen Container -->
    <div id="screen-container" class="flex-1 overflow-y-auto pb-20"></div>
    
    <!-- Bottom Navigation -->
    <div class="bg-white border-t border-gray-200 px-4 py-2 fixed bottom-0 left-1/2 transform -translate-x-1/2 w-full max-w-sm z-10">
      <div class="flex justify-around">
        <button data-screen="dashboard" class="nav-btn flex flex-col items-center py-2 px-3 text-blue-600">
          <i class="fa-solid fa-chart-column text-xl"></i>
          <span class="text-xs mt-1">Сводка</span>
        </button>
        <button data-screen="crm" class="nav-btn flex flex-col items-center py-2 px-3 text-gray-500">
          <i class="fa-solid fa-users text-xl"></i>
          <span class="text-xs mt-1">CRM</span>
        </button>
        <button data-screen="profile" class="nav-btn flex flex-col items-center py-2 px-3 text-gray-500">
          <i class="fa-solid fa-gear text-xl"></i>
          <span class="text-xs mt-1">Профиль</span>
        </button>
      </div>
    </div>
    
  </div>
  
  <!-- AI Chat Modal -->
  <div id="ai-modal" class="modal-overlay">
    <div class="modal-content">
      <div class="bg-white p-4 border-b border-gray-200 flex justify-between items-center">
        <h2 class="text-lg font-semibold text-gray-900">ИИ-агент</h2>
        <button id="close-ai-modal" class="text-gray-500 hover:text-gray-700">
          <i class="fa-solid fa-xmark text-xl"></i>
        </button>
      </div>
      
      <div id="ai-messages" class="overflow-y-auto p-4 space-y-3" style="height: calc(85vh - 180px);">
        <!-- Сообщения здесь -->
      </div>
      
      <div class="p-4 border-t border-gray-200 space-y-2">
        <div class="flex gap-1 overflow-x-auto pb-2 scrollbar-hide">
          <button class="ai-action-btn flex-shrink-0 bg-gray-100 text-gray-700 py-1 px-3 rounded-full text-xs whitespace-nowrap">
            дожим после демо
          </button>
          <button class="ai-action-btn flex-shrink-0 bg-gray-100 text-gray-700 py-1 px-3 rounded-full text-xs whitespace-nowrap">
            напомнить оплату
          </button>
          <button class="ai-action-btn flex-shrink-0 bg-gray-100 text-gray-700 py-1 px-3 rounded-full text-xs whitespace-nowrap">
            рассылка
          </button>
          <button class="ai-action-btn flex-shrink-0 bg-gray-100 text-gray-700 py-1 px-3 rounded-full text-xs whitespace-nowrap">
            отчет за неделю
          </button>
        </div>
        
        <div class="flex gap-2">
          <button class="text-gray-500 p-2">
            <i class="fa-solid fa-paperclip"></i>
          </button>
          <input id="ai-input" type="text" placeholder="Сообщение агенту..." 
            class="flex-1 border border-gray-300 rounded-lg px-3 py-2 text-sm" />
          <button id="ai-send" class="bg-blue-600 text-white p-2 rounded-lg">
            <i class="fa-solid fa-paper-plane"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ========== DATA ==========
    const clients = [
      {
        id: 1,
        name: "Константин Константинопольский",
        status: "Купил",
        lastContact: "1 день назад",
        overdue: false,
        unread: false,
        avatar: "https://placehold.co/40x40/FFD700/000000?text=К",
        day: "Пн",
        location: "клуб",
        premium: true,
        phone: "+7 (999) 123-45-67",
        email: "konstantin@example.com",
        age: 32,
        purchasedProducts: ["Персональные тренировки", "Диета"],
        history: [
          { date: "2025-11-08", message: "Напоминание об оплате отправлено", sender: "агент" },
          { date: "2025-11-07", message: "Предложение о новом тарифе", sender: "тренер" },
        ],
        activity: { calories: 2200, steps: 8500, water: 2.5, workouts: 4, sleep: 7.2 },
      },
      {
        id: 2,
        name: "Марго Р.",
        status: "Демо",
        lastContact: "2 дня назад",
        overdue: false,
        unread: true,
        avatar: "https://placehold.co/40x40/FFD700/000000?text=M",
        day: "Пн",
        location: "онлайн",
        phone: "+7 (999) 123-45-68",
        email: "margo@example.com",
        age: 28,
        purchasedProducts: [],
        history: [{ date: "2025-11-06", message: "Демо-запись отправлена", sender: "тренер" }],
        activity: { calories: 1800, steps: 6200, water: 1.8, workouts: 2, sleep: 6.5 },
      },
      {
        id: 3,
        name: "Анна Петрова",
        status: "Купил",
        lastContact: "2 часа назад",
        overdue: false,
        premium: true,
        avatar: "https://placehold.co/40x40/FF69B4/FFFFFF?text=A",
        day: "Вт",
        location: "клуб",
        phone: "+7 (999) 123-45-69",
        email: "anna@example.com",
        age: 35,
        purchasedProducts: ["Персональные тренировки", "Диета", "Групповые занятия"],
        history: [
          { date: "2025-11-09", message: "Напоминание об оплате отправлено", sender: "агент" },
          { date: "2025-11-08", message: "Программа тренировок отправлена", sender: "тренер" },
        ],
        activity: { calories: 2400, steps: 10200, water: 3.0, workouts: 6, sleep: 8.0 },
      },
      {
        id: 4,
        name: "Иван Сидоров",
        status: "Думает",
        lastContact: "1 час назад",
        overdue: true,
        avatar: "https://placehold.co/40x40/4169E1/FFFFFF?text=И",
        day: "Ср",
        location: "воркаут",
        phone: "+7 (999) 123-45-70",
        email: "ivan@example.com",
        age: 29,
        purchasedProducts: [],
        history: [{ date: "2025-11-05", message: "Консультация по тренировкам", sender: "тренер" }],
        activity: { calories: 2000, steps: 7200, water: 2.0, workouts: 3, sleep: 6.8 },
      },
      {
        id: 5,
        name: "Мария Козлова",
        status: "Демо",
        lastContact: "5 часов назад",
        overdue: false,
        avatar: "https://placehold.co/40x40/32CD32/FFFFFF?text=М",
        day: "Чт",
        location: "онлайн",
        phone: "+7 (999) 123-45-71",
        email: "maria@example.com",
        age: 26,
        purchasedProducts: [],
        history: [{ date: "2025-11-04", message: "Демо-запись отправлена", sender: "тренер" }],
        activity: { calories: 1700, steps: 5800, water: 1.5, workouts: 1, sleep: 6.0 },
      },
      {
        id: 6,
        name: "Дмитрий Волков",
        status: "Новый",
        lastContact: "3 дня назад",
        overdue: true,
        avatar: "https://placehold.co/40x40/FF4500/FFFFFF?text=Д",
        day: "Пт",
        location: "клуб",
        phone: "+7 (999) 123-45-72",
        email: "dmitry@example.com",
        age: 31,
        purchasedProducts: [],
        history: [{ date: "2025-11-03", message: "Регистрация нового клиента", sender: "система" }],
        activity: { calories: 1900, steps: 6800, water: 2.2, workouts: 2, sleep: 7.0 },
      },
    ];

    const tasks = [
      { id: 1, text: "Напомнить Марго о записи", client: "Марго Р.", date: "2025-11-09", overdue: false },
      { id: 2, text: "Напомнить Анне об оплате", client: "Анна Петрова", date: "2025-11-08", overdue: true },
      { id: 3, text: "Отправить программу Ивану", client: "Иван Сидоров", date: "2025-11-09", overdue: false },
      { id: 4, text: "Позвонить Марии для подтверждения", client: "Мария Козлова", date: "2025-11-10", overdue: false },
    ];

    // ========== STATE ==========
    let currentScreen = 'dashboard';
    let currentCRMTab = 'clients';
    let searchQuery = '';
    let statusFilter = 'Все';
    let selectedClient = null;
    let clientDetailTab = 'info'; // 'info' или 'activity'
    
    let aiMessages = [
      { id: 1, sender: "agent", text: "Привет! У тебя есть клиенты, которым нужно напомнить об оплате." },
      { id: 2, sender: "trainer", text: "Да, отправь мне список" },
      { id: 3, sender: "agent", text: "Вот клиенты с просрочкой:" },
    ];

    // ========== NAVIGATION ==========
    const navBtns = document.querySelectorAll('.nav-btn');
    navBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const screen = btn.dataset.screen;
        switchScreen(screen);
      });
    });

    function switchScreen(screen) {
      currentScreen = screen;
      selectedClient = null;
      updateNavButtons();
      renderScreen();
    }

    function updateNavButtons() {
      navBtns.forEach(btn => {
        if (btn.dataset.screen === currentScreen) {
          btn.classList.remove('text-gray-500');
          btn.classList.add('text-blue-600');
        } else {
          btn.classList.remove('text-blue-600');
          btn.classList.add('text-gray-500');
        }
      });
    }

    // ========== AI MODAL ==========
    const aiChatBtn = document.getElementById('ai-chat-btn');
    const aiModal = document.getElementById('ai-modal');
    const closeAiModal = document.getElementById('close-ai-modal');
    const aiInput = document.getElementById('ai-input');
    const aiSend = document.getElementById('ai-send');
    const aiMessagesContainer = document.getElementById('ai-messages');

    aiChatBtn.addEventListener('click', () => {
      aiModal.classList.add('active');
      renderAIMessages();
    });

    closeAiModal.addEventListener('click', () => {
      aiModal.classList.remove('active');
    });

    aiModal.addEventListener('click', (e) => {
      if (e.target === aiModal) {
        aiModal.classList.remove('active');
      }
    });

    aiSend.addEventListener('click', sendAIMessage);
    aiInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') sendAIMessage();
    });

    document.querySelectorAll('.ai-action-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const action = btn.textContent.trim();
        aiMessages.push({ id: Date.now(), sender: 'agent', text: `Действие: ${action}` });
        renderAIMessages();
      });
    });

    function sendAIMessage() {
      const text = aiInput.value.trim();
      if (!text) return;
      aiMessages.push({ id: Date.now(), sender: 'trainer', text });
      aiInput.value = '';
      renderAIMessages();
    }

    function renderAIMessages() {
      aiMessagesContainer.innerHTML = aiMessages.map(msg => `
        <div class="flex ${msg.sender === 'trainer' ? 'justify-end' : 'justify-start'}">
          <div class="max-w-xs ${msg.sender === 'trainer' ? 'bg-blue-600 text-white' : 'bg-white text-gray-800 border border-gray-200'} rounded-lg p-3 shadow-sm">
            <p class="text-sm">${msg.text}</p>
          </div>
        </div>
      `).join('');
      aiMessagesContainer.scrollTop = aiMessagesContainer.scrollHeight;
    }

    // ========== SCREENS ==========
    function renderScreen() {
      const container = document.getElementById('screen-container');
      const header = document.getElementById('header-title');
      const aiChatBtn = document.getElementById('ai-chat-btn');
      
      if (selectedClient) {
        header.textContent = 'Детали клиента';
        aiChatBtn.textContent = '';
        aiChatBtn.innerHTML = '<i class="fa-solid fa-chevron-left"></i>';
        aiChatBtn.style.background = '#F3F4F6';
        aiChatBtn.style.color = '#1F2937';
        aiChatBtn.onclick = () => {
          selectedClient = null;
          renderScreen();
        };
        container.innerHTML = renderClientDetail();
        initClientDetailSwipes();
        return;
      }
      
      aiChatBtn.textContent = 'Ai-чат';
      aiChatBtn.style.background = 'linear-gradient(90deg, #4A90E2 0%, #7C3AED 100%)';
      aiChatBtn.style.color = '#FFFFFF';
      aiChatBtn.onclick = () => {
        aiModal.classList.add('active');
        renderAIMessages();
      };
      
      switch(currentScreen) {
        case 'dashboard':
          header.innerHTML = `
            <svg width="110" height="32" viewBox="0 0 110 32" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="gofitGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                  <stop offset="0%" stop-color="#4A90E2"/>
                  <stop offset="100%" stop-color="#7C3AED"/>
                </linearGradient>
              </defs>
              <text x="0" y="24" font-family="Poppins, Inter, Montserrat, system-ui, sans-serif" font-size="20" font-weight="700" fill="url(#gofitGradient)">GoFit<tspan fill="#2ECC71">.</tspan><tspan font-weight="300" fill="#6B7280">AI</tspan></text>
            </svg>
          `;
          container.innerHTML = renderDashboard();
          break;
        case 'crm':
          header.textContent = 'CRM';
          container.innerHTML = renderCRM();
          initCRMSwipes();
          break;
        case 'profile':
          header.textContent = 'Профиль';
          container.innerHTML = renderProfile();
          break;
      }
    }

    // ========== DASHBOARD ==========
    function renderDashboard() {
      const filteredClients = clients.filter(c => c.status === "Демо" || c.status === "Купил");
      
      return `
        <div class="p-4 space-y-4">
          <div class="grid grid-cols-2 gap-3">
            <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-100">
              <div class="flex items-center gap-2 mb-2">
                <i class="fa-solid fa-users text-blue-600"></i>
                <span class="text-sm text-gray-600">Клиенты</span>
              </div>
              <p class="text-2xl font-bold text-gray-900">24</p>
              <p class="text-xs text-green-600">+2 за неделю</p>
            </div>
            
            <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-100">
              <div class="flex items-center gap-2 mb-2">
                <i class="fa-solid fa-coins text-green-600"></i>
                <span class="text-sm text-gray-600">Выручка</span>
              </div>
              <p class="text-2xl font-bold text-gray-900">125т</p>
              <p class="text-xs text-green-600">+15% за месяц</p>
            </div>
            
            <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-100">
              <div class="flex items-center gap-2 mb-2">
                <i class="fa-solid fa-arrow-trend-up text-purple-600"></i>
                <span class="text-sm text-gray-600">Продажи</span>
              </div>
              <p class="text-2xl font-bold text-gray-900">8</p>
              <p class="text-xs text-green-600">+1 за неделю</p>
            </div>
            
            <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-100">
              <div class="flex items-center gap-2 mb-2">
                <i class="fa-regular fa-calendar-check text-orange-600"></i>
                <span class="text-sm text-gray-600">Задачи</span>
              </div>
              <p class="text-2xl font-bold text-gray-900">15</p>
              <p class="text-xs text-gray-500">на неделе</p>
            </div>
          </div>
          
          <div class="flex space-x-4 overflow-x-auto pb-4 scrollbar-hide">
            <div class="flex-shrink-0 w-[92%] bg-white rounded-lg p-4 shadow-sm border border-gray-100">
              <div class="flex justify-between items-center mb-3">
                <h3 class="font-medium text-gray-900">Ближайшие задачи</h3>
              </div>
              ${tasks.slice(0, 3).map(task => `
                <div class="flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0">
                  <div>
                    <p class="text-sm text-gray-800">${task.text}</p>
                    <p class="text-xs text-gray-500">${task.client}</p>
                  </div>
                  <span class="text-xs px-2 py-1 rounded ${task.overdue ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                    ${task.overdue ? 'Просрочено' : task.date}
                  </span>
                </div>
              `).join('')}
            </div>
            
            <div class="flex-shrink-0 w-[92%] bg-white rounded-lg p-4 shadow-sm border border-gray-100">
              <div class="flex justify-between items-center mb-3">
                <h3 class="font-medium text-gray-900">Клиенты на неделе</h3>
              </div>
              ${filteredClients.slice(0, 3).map(client => `
                <div class="flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0">
                  <div class="flex-1">
                    <div class="flex justify-between items-center">
                      <p class="text-sm text-gray-800">${client.name}</p>
                      <div class="flex gap-2">
                        <span class="text-xs px-2 py-1 rounded ${getStatusColor(client.status)}">
                          ${client.day}
                        </span>
                        <span class="text-xs px-2 py-1 rounded bg-gray-100 text-gray-800">
                          ${client.location}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }

    // ========== CRM ==========
    function renderCRM() {
      return `
        <div class="bg-white p-4 border-b border-gray-200">
          <div class="flex gap-2 items-center">
            <button class="crm-tab-btn ${currentCRMTab === 'clients' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700'} flex-1 py-2 px-3 rounded-lg text-sm font-medium" data-tab="clients">
              Клиенты
            </button>
            <button class="crm-tab-btn ${currentCRMTab === 'deals' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700'} flex-1 py-2 px-3 rounded-lg text-sm font-medium" data-tab="deals">
              Сделки
            </button>
            <button class="crm-tab-btn ${currentCRMTab === 'reports' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700'} flex-1 py-2 px-3 rounded-lg text-sm font-medium" data-tab="reports">
              Рассылки
            </button>
            <button class="p-2 rounded-lg" style="background-color: #2ECC71; color: white;">
              <i class="fa-solid fa-plus"></i>
            </button>
          </div>
        </div>
        
        <div id="crm-content">
          ${currentCRMTab === 'clients' ? renderCRMClients() : ''}
          ${currentCRMTab === 'deals' ? renderCRMDeals() : ''}
          ${currentCRMTab === 'reports' ? renderCRMReports() : ''}
        </div>
      `;
    }

    function renderCRMClients() {
      const filtered = clients.filter(c => {
        const matchesSearch = c.name.toLowerCase().includes(searchQuery.toLowerCase());
        const matchesStatus = statusFilter === 'Все' || c.status === statusFilter;
        return matchesSearch && matchesStatus;
      });
      
      return `
        <div class="p-4 space-y-3">
          <div class="relative">
            <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
              <i class="fa-solid fa-magnifying-glass"></i>
            </div>
            <input type="text" id="search-input" placeholder="Поиск клиентов..." value="${searchQuery}"
              class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm" />
          </div>
          
          <div class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide">
            ${['Все', 'Купил', 'Думает', 'Демо', 'Новый'].map(filter => `
              <button class="status-filter-btn flex-shrink-0 px-3 py-1 rounded-full text-xs whitespace-nowrap ${statusFilter === filter ? 'bg-blue-600 text-white' : getFilterColor(filter)}" data-filter="${filter}">
                ${filter}
              </button>
            `).join('')}
          </div>
          
          <div class="space-y-3">
            ${filtered.length ? filtered.map(client => `
              <div class="client-card bg-white rounded-lg p-4 shadow-sm border border-gray-100 cursor-pointer" data-client-id="${client.id}">
                <div class="flex items-start gap-3">
                  <img src="${client.avatar}" alt="${client.name}" class="w-10 h-10 rounded-full flex-shrink-0" />
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2 mb-1">
                      <h3 class="font-medium text-gray-900 truncate">${client.name}</h3>
                      ${client.premium ? '<i class="fa-solid fa-crown text-yellow-500 text-sm flex-shrink-0"></i>' : ''}
                    </div>
                    <span class="inline-block px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(client.status)}">
                      ${client.status}
                    </span>
                  </div>
                </div>
              </div>
            `).join('') : '<div class="text-center py-8"><p class="text-gray-500">Клиенты не найдены</p></div>'}
          </div>
        </div>
      `;
    }

    function renderCRMDeals() {
      return `
        <div class="p-4 space-y-6">
          <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-100">
            <h3 class="font-medium text-gray-900 mb-3">Воронки продаж</h3>
            <div class="space-y-3">
              <div class="flex justify-between items-center">
                <span class="text-sm text-gray-600">Новые лиды</span>
                <span class="text-sm font-medium text-gray-900">12</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-sm text-gray-600">На консультации</span>
                <span class="text-sm font-medium text-gray-900">8</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-sm text-gray-600">Покупка</span>
                <span class="text-sm font-medium text-gray-900">5</span>
              </div>
            </div>
          </div>
          
          <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-100">
            <h3 class="font-medium text-gray-900 mb-3">Сегменты</h3>
            <div class="space-y-3">
              <div class="flex justify-between items-center">
                <span class="text-sm text-gray-600">Новые клиенты</span>
                <span class="text-sm font-medium text-gray-900">8</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-sm text-gray-600">Повторные</span>
                <span class="text-sm font-medium text-gray-900">16</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-sm text-gray-600">VIP-клиенты</span>
                <span class="text-sm font-medium text-gray-900">4</span>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderCRMReports() {
      return `
        <div class="p-4 space-y-6">
          <div class="grid grid-cols-3 gap-3">
            <div class="border border-gray-200 rounded-lg p-3 text-center bg-blue-50">
              <i class="fa-regular fa-envelope text-blue-600 text-[20px] mx-auto mb-1"></i>
              <p class="text-xs text-gray-600">Активные рассылки</p>
              <p class="text-lg font-bold text-gray-900">3</p>
            </div>
            <div class="border border-gray-200 rounded-lg p-3 text-center bg-green-50">
              <i class="fa-regular fa-eye text-green-600 text-[20px] mx-auto mb-1"></i>
              <p class="text-xs text-gray-600">Открытие</p>
              <p class="text-lg font-bold text-gray-900">65%</p>
            </div>
            <div class="border border-gray-200 rounded-lg p-3 text-center bg-purple-50">
              <i class="fa-solid fa-arrow-trend-up text-purple-600 text-[20px] mx-auto mb-1"></i>
              <p class="text-xs text-gray-600">Конверсия</p>
              <p class="text-lg font-bold text-gray-900">12%</p>
            </div>
          </div>
          
          <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-100">
            <h3 class="font-medium text-gray-900 mb-3">Метрики (KPI)</h3>
            <div class="space-y-3">
              <div class="flex justify-between items-center">
                <span class="text-sm text-gray-600">Средний чек</span>
                <span class="text-sm font-medium text-gray-900">8т</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-sm text-gray-600">LTV</span>
                <span class="text-sm font-medium text-gray-900">32т</span>
              </div>
            </div>
          </div>
          
          <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-100">
            <h3 class="font-medium text-gray-900 mb-3">Каналы</h3>
            <div class="space-y-3">
              <div class="flex justify-between items-center">
                <span class="text-sm text-gray-600">Instagram</span>
                <span class="text-sm font-medium text-gray-900">45%</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-sm text-gray-600">Рекомендации</span>
                <span class="text-sm font-medium text-gray-900">30%</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-sm text-gray-600">Реклама</span>
                <span class="text-sm font-medium text-gray-900">25%</span>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // ========== CLIENT DETAIL ==========
    function renderClientDetail() {
      if (!selectedClient) return '';
      
      return `
        <div class="flex flex-col h-full">
          <div class="bg-white border-b border-gray-200">
            <div class="relative flex">
              <button class="client-tab-btn flex-1 py-3 text-sm font-medium ${clientDetailTab === 'info' ? 'text-blue-600' : 'text-gray-600'}" data-tab="info">
                Инфо
              </button>
              <button class="client-tab-btn flex-1 py-3 text-sm font-medium ${clientDetailTab === 'activity' ? 'text-blue-600' : 'text-gray-600'}" data-tab="activity">
                Активность
              </button>
              <div class="tab-indicator" style="width: 50%; left: ${clientDetailTab === 'info' ? '0%' : '50%'};"></div>
            </div>
          </div>
          
          <div id="client-detail-content" class="flex-1 overflow-y-auto p-4 space-y-6">
            ${clientDetailTab === 'info' ? renderClientInfo() : renderClientActivity()}
          </div>
          
          <div class="p-4 bg-white border-t border-gray-200">
            <button class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 px-6 rounded-xl font-medium flex items-center justify-center gap-2">
              <i class="fa-solid fa-message"></i>
              Сообщение
            </button>
          </div>
        </div>
      `;
    }

    function renderClientInfo() {
      return `
        <div class="flex flex-col items-center">
          <img src="${selectedClient.avatar}" alt="${selectedClient.name}" class="w-24 h-24 rounded-full mb-4 border-4 border-blue-100" />
          <h2 class="text-xl font-bold text-gray-900">${selectedClient.name}</h2>
          <div class="flex items-center gap-2 mt-2">
            <i class="fa-solid fa-check text-green-500"></i>
            <span class="text-sm font-medium text-green-600 bg-green-100 px-3 py-1 rounded-full">
              Подтвержден
            </span>
          </div>
        </div>
        
        <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
          <h3 class="font-medium text-gray-900 mb-3">Контактная информация</h3>
          <div class="space-y-3">
            <div class="flex justify-between items-center">
              <span class="text-gray-500">Телефон</span>
              <div class="flex items-center gap-2">
                <i class="fa-solid fa-phone text-gray-400"></i>
                <span class="text-gray-900">${selectedClient.phone}</span>
              </div>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-gray-500">Email</span>
              <div class="flex items-center gap-2">
                <i class="fa-regular fa-envelope text-gray-400"></i>
                <span class="text-gray-900">${selectedClient.email}</span>
              </div>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-gray-500">Возраст</span>
              <div class="flex items-center gap-2">
                <i class="fa-solid fa-user text-gray-400"></i>
                <span class="text-gray-900">${selectedClient.age} лет</span>
              </div>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-gray-500">Местоположение</span>
              <div class="flex items-center gap-2">
                <i class="fa-solid fa-location-dot text-gray-400"></i>
                <span class="text-gray-900">${selectedClient.location}</span>
              </div>
            </div>
          </div>
        </div>
        
        <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
          <h3 class="font-medium text-gray-900 mb-3">История</h3>
          <div class="space-y-3">
            ${selectedClient.history.map(item => `
              <div class="border-b border-gray-100 pb-3 last:border-b-0 last:pb-0">
                <p class="text-sm text-gray-800">${item.message}</p>
                <div class="flex justify-between items-center mt-1">
                  <span class="text-xs text-gray-500">${item.date}</span>
                  <span class="text-xs text-gray-400">${item.sender}</span>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    function renderClientActivity() {
      return `
        <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
          <h3 class="font-medium text-gray-900 mb-4">Физическая активность</h3>
          <div class="grid grid-cols-2 gap-4">
            <div class="border border-gray-200 rounded-lg p-3 text-center">
              <div class="text-2xl font-bold text-gray-900">${selectedClient.activity.calories}</div>
              <p class="text-sm text-gray-600">Калории</p>
            </div>
            <div class="border border-gray-200 rounded-lg p-3 text-center">
              <div class="text-2xl font-bold text-gray-900">${selectedClient.activity.steps}</div>
              <p class="text-sm text-gray-600">Шаги</p>
            </div>
            <div class="border border-gray-200 rounded-lg p-3 text-center">
              <div class="text-2xl font-bold text-gray-900">${selectedClient.activity.water}л</div>
              <p class="text-sm text-gray-600">Вода</p>
            </div>
            <div class="border border-gray-200 rounded-lg p-3 text-center">
              <div class="text-2xl font-bold text-gray-900">${selectedClient.activity.workouts}</div>
              <p class="text-sm text-gray-600">Тренировки</p>
            </div>
            <div class="border border-gray-200 rounded-lg p-3 text-center col-span-2">
              <div class="text-2xl font-bold text-gray-900">${selectedClient.activity.sleep}ч</div>
              <p class="text-sm text-gray-600">Сон</p>
            </div>
          </div>
        </div>
        
        <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
          <h3 class="font-medium text-gray-900 mb-3">Статистика за неделю</h3>
          <div class="space-y-3">
            <div class="flex justify-between items-center">
              <span class="text-gray-700">Средние шаги</span>
              <span class="text-gray-900">7800/день</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-gray-700">Средние калории</span>
              <span class="text-gray-900">2100/день</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-gray-700">Активные дни</span>
              <span class="text-gray-900">5/7</span>
            </div>
          </div>
        </div>
        
        <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
          <h3 class="font-medium text-gray-900 mb-3">Заказы</h3>
          <div class="space-y-3">
            ${selectedClient.purchasedProducts.length ? selectedClient.purchasedProducts.map(product => `
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="p-2 bg-blue-100 rounded-lg">
                    <i class="fa-solid fa-check text-blue-600"></i>
                  </div>
                  <span class="text-gray-700">${product}</span>
                </div>
              </div>
            `).join('') : '<p class="text-gray-500 text-center py-4">Нет приобретенных продуктов</p>'}
          </div>
        </div>
      `;
    }

    // ========== PROFILE ==========
    function renderProfile() {
      return `
        <div class="p-4 space-y-3">
          <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-100">
            <h3 class="font-medium text-gray-900 mb-3 flex items-center gap-2">
              <i class="fa-solid fa-user text-[16px]"></i>
              О тренере
            </h3>
            <div class="space-y-2">
              <div>
                <p class="text-sm text-gray-600">Имя</p>
                <p class="text-sm font-medium text-gray-900">Иван Иванов</p>
              </div>
              <div>
                <p class="text-sm text-gray-600">Стаж</p>
                <p class="text-sm font-medium text-gray-900">5 лет</p>
              </div>
              <div>
                <p class="text-sm text-gray-600">Специализация</p>
                <p class="text-sm font-medium text-gray-900">Персональный тренинг, питание</p>
              </div>
              <div>
                <p class="text-sm text-gray-600">Контакт</p>
                <p class="text-sm font-medium text-gray-900">+7 (999) 123-45-67</p>
              </div>
            </div>
          </div>
          
          <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-100">
            <h3 class="font-medium text-gray-900 mb-3 flex items-center gap-2">
              <i class="fa-solid fa-box-archive text-[16px]"></i>
              Настройки CRM
            </h3>
            <div class="space-y-3">
              <div class="border border-gray-200 rounded-lg p-3">
                <h4 class="font-medium text-gray-900 mb-2">Продукты и услуги</h4>
                <div class="text-sm text-gray-600 space-y-1">
                  <p>Персональные тренировки — 5000 руб</p>
                  <p>План питания — 2000 руб</p>
                  <p>Программа тренировок — 3000 руб</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-100">
            <h3 class="font-medium text-gray-900 mb-3 flex items-center gap-2">
              <i class="fa-solid fa-gear text-[16px]"></i>
              О приложении
            </h3>
            <div class="space-y-3">
              <button class="w-full text-left text-sm text-gray-700 py-2 border-b border-gray-100">
                Условия пользования
              </button>
              <button class="w-full text-left text-sm text-gray-700 py-2 border-b border-gray-100">
                Политика конфиденциальности
              </button>
              <button class="w-full text-left text-sm text-gray-700 py-2">
                Справочный центр
              </button>
            </div>
          </div>
          
          <div class="text-center text-xs text-gray-500 mt-4">
            <p>Ai может ошибаться — проверяйте информацию.</p>
          </div>
        </div>
      `;
    }

    // ========== HELPERS ==========
    function getStatusColor(status) {
      const colors = {
        'Купил': 'bg-green-100 text-green-800',
        'Думает': 'bg-yellow-100 text-yellow-800',
        'Демо': 'bg-blue-100 text-blue-800',
        'Новый': 'bg-purple-100 text-purple-800'
      };
      return colors[status] || 'bg-gray-100 text-gray-800';
    }

    function getFilterColor(filter) {
      const colors = {
        'Купил': 'bg-green-100 text-green-800',
        'Думает': 'bg-yellow-100 text-yellow-800',
        'Демо': 'bg-blue-100 text-blue-800',
        'Новый': 'bg-purple-100 text-purple-800'
      };
      return colors[filter] || 'bg-gray-100 text-gray-700';
    }

    // ========== EVENT DELEGATION ==========
    document.addEventListener('click', (e) => {
      // CRM Tab switching
      if (e.target.closest('.crm-tab-btn')) {
        const tab = e.target.closest('.crm-tab-btn').dataset.tab;
        currentCRMTab = tab;
        renderScreen();
      }
      
      // Search
      if (e.target.id === 'search-input') {
        e.target.addEventListener('input', (ev) => {
          searchQuery = ev.target.value;
          document.getElementById('crm-content').innerHTML = renderCRMClients();
        });
      }
      
      // Status filter
      if (e.target.closest('.status-filter-btn')) {
        statusFilter = e.target.closest('.status-filter-btn').dataset.filter;
        document.getElementById('crm-content').innerHTML = renderCRMClients();
      }
      
      // Client card click
      if (e.target.closest('.client-card')) {
        const clientId = parseInt(e.target.closest('.client-card').dataset.clientId);
        selectedClient = clients.find(c => c.id === clientId);
        clientDetailTab = 'info';
        renderScreen();
      }
      
      // Client detail tabs
      if (e.target.closest('.client-tab-btn')) {
        clientDetailTab = e.target.closest('.client-tab-btn').dataset.tab;
        renderScreen();
      }
    });

    // ========== SWIPES ==========
    let touchStartX = 0;
    let touchEndX = 0;

    function initCRMSwipes() {
      const content = document.getElementById('crm-content');
      
      content.addEventListener('touchstart', (e) => {
        touchStartX = e.touches[0].clientX;
      });
      
      content.addEventListener('touchmove', (e) => {
        touchEndX = e.touches[0].clientX;
      });
      
      content.addEventListener('touchend', () => {
        if (!touchStartX || !touchEndX) return;
        const diff = touchStartX - touchEndX;
        
        if (Math.abs(diff) > 50) {
          if (diff > 0) { // Свайп влево
            if (currentCRMTab === 'clients') currentCRMTab = 'deals';
            else if (currentCRMTab === 'deals') currentCRMTab = 'reports';
          } else { // Свайп вправо
            if (currentCRMTab === 'deals') currentCRMTab = 'clients';
            else if (currentCRMTab === 'reports') currentCRMTab = 'deals';
          }
          renderScreen();
        }
        
        touchStartX = 0;
        touchEndX = 0;
      });
    }

    function initClientDetailSwipes() {
      const content = document.getElementById('client-detail-content');
      
      content.addEventListener('touchstart', (e) => {
        touchStartX = e.touches[0].clientX;
      });
      
      content.addEventListener('touchmove', (e) => {
        touchEndX = e.touches[0].clientX;
      });
      
      content.addEventListener('touchend', () => {
        if (!touchStartX || !touchEndX) return;
        const diff = touchStartX - touchEndX;
        
        if (Math.abs(diff) > 50) {
          if (diff > 0 && clientDetailTab === 'info') {
            clientDetailTab = 'activity';
            renderScreen();
          } else if (diff < 0 && clientDetailTab === 'activity') {
            clientDetailTab = 'info';
            renderScreen();
          }
        }
        
        touchStartX = 0;
        touchEndX = 0;
      });
    }

    // ========== INIT ==========
    renderScreen();
    renderAIMessages();
  </script>
</body>
</html>
